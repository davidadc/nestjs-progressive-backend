// Prisma schema for Task Management API

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum UserRole {
  ADMIN
  MANAGER
  USER
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
}

// Models
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(USER)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  ownedProjects  Project[]     @relation("ProjectOwner")
  memberProjects Project[]     @relation("ProjectMembers")
  createdTasks   Task[]        @relation("TaskCreator")
  assignedTasks  Task[]        @relation("TaskAssignee")
  comments       TaskComment[]

  @@map("users")
}

model Project {
  id          String   @id @default(uuid())
  name        String
  description String?
  ownerId     String   @map("owner_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  owner   User   @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members User[] @relation("ProjectMembers")
  tasks   Task[]

  @@map("projects")
}

model Task {
  id           String       @id @default(uuid())
  projectId    String       @map("project_id")
  title        String
  description  String?
  status       TaskStatus   @default(TODO)
  priority     TaskPriority @default(MEDIUM)
  dueDate      DateTime?    @map("due_date")
  assignedToId String?      @map("assigned_to_id")
  createdById  String       @map("created_by_id")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  // Relations
  project    Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignedTo User?         @relation("TaskAssignee", fields: [assignedToId], references: [id], onDelete: SetNull)
  createdBy  User          @relation("TaskCreator", fields: [createdById], references: [id], onDelete: Cascade)
  comments   TaskComment[]

  @@map("tasks")
}

model TaskComment {
  id        String   @id @default(uuid())
  taskId    String   @map("task_id")
  userId    String   @map("user_id")
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  task Task @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("task_comments")
}
